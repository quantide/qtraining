---
title: "Introduction to Graphics"
author: "Veronica"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r options, include=FALSE, purl=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.pos = 'H', fig.width = 4, fig.height = 3)
options(width = 108)
require(knitr)
```


<!--
# Introduction to Graphics
-->

La rappresentazione dei dati è un tema di fondamentale importanza ai nosti giorni. Un'accorta rappresentazione di ciò che i dati raccontano aiuta a prendere le giuste decisioni a livello di business.

<!--
Visualizing data is crucial in today's world. Without powerful visualizations, it is almost impossible to create and narrate stories on data. These stories help us build strategies and make intelligent business decisions. 
-->

R è uno strumento valido per la data visualization. Fornisce, infatti, principalmente tre sistemi grafici: `graphics` che fa parte dei pacchetti base di R e che consente di rappresentare i grafici più semplici, `lattice` che è un'implementazione della grafica trellis di William Clevelande e `ggplot2` che è un'implementazione della cosidetta _Grammar of Graphics_ di Leland Wilkinson. Il CRAN fornisce una [Task View on Graphics](https://cran.r-project.org/web/views/Graphics.html), cioè una lista di tutti pacchetti R inerenti alla grafica, dai tre menzionati sopra a pacchetti che producono grafici specifici.   

<!--
R is well supported to make data visualization. It provides at least three main graphical systems: `graphics` that comes with base R, `lattice` that is an R implementation of William Cleveland's trellis graphics and `ggplot2` that is an R implementation of Leland Wilkinson's Grammar of Graphics. CRAN provides a [Task View on Graphics](https://cran.r-project.org/web/views/Graphics.html), that is an organized list of all R packages about graphics, that includes not only the three main graphical systems but also packages to produce specialized plots.
-->

Questo libro parlerà in particolare di `ggplot2`. Negli ultimi tempi è diventato un sinonimo di data visualization con R e ci sono almeno due motivi principali per preferirlo agli altri sistemi grfici:

* `ggplot2` è più recente rispetto aglia ltri sistemi grafici
* `ggplot2` è costruita sull'idea della semantica dei grafici che pone più l'accento sul reshape dei dati, sulal trasformazione e sull'assemblaggio degli elementi del grafico

<!--
In the following chapters, `ggplot2` graphics are shown. `ggplot2` package has become a synonym for data visualization in R and there are at least two main reasons to prefer it than other graphic systems:

 - `ggplot2` is newer than other graphic systems;
 - `ggplot2` is built on the idea of a semantics for graphics and there is much more emphasis on reshaping data, transformation, and assembling the elements of a plot.
-->

`ggplot2` è stato scritto da Hadley Wickham e da Winston Chang. Se ve lo state chiedendo Wickham ha scritto anche il pacchetto `ggplot` (senza alcun numero), pacchetto che è stato archiviato dal CRAN nel 2008.  

<!--
`ggplot2` was written by Hadley Wickham and Winston Chang. If you are wondering, Wickham wrote also a `ggplot` package (without any number) that was archived by CRAN in 2008.
-->

Il punto di partenza per approfondire `ggplot2` è il [sito ufficiale](http://ggplot2.org/) che fornisce docuemntazione, la mailing list ufficiale e altre risorse.

<!--
The starting point for more information about `ggplot2` is the [official website](http://ggplot2.org/) providing documentation, the official mailing list and other resources.
-->

Per prima cosa carichaimo il pacchetto, supponendo che sia già stato installato.

<!--
Supposing the package is already installed, first of all `ggplot2` must be loaded.  
-->

```{r intro_require_ggplot, message=FALSE}
require(ggplot2)
```

<!--
## An overview of ggplot2 grammar
-->

## Un'overview sulla grammatica di ggplot2

`ggplot2` è uno strumento molto potente che consente di realizzare molti tipo di grafici, anche complessi e personalizzati, combinando più fonti di dati. Per fare ciò, tuttavia, è necessario avere chiara la grammatica che sta alla base e come tutte le componenti si incastrino tra di loro. 

Come abbiamo detto, `ggplot2` è uno sviluppo della cosidetta Leland Wilkinson's Grammar of Graphics, una prospettiva formale e ben strutturata della grafica dei dati. La grammatica di `ggplot2` è detta stratificata perche è la costruzione di un grafico è strutturata a blocchi. L'idea che sta alla base di tutto è la specificazione indipendente di ogni blocco che costruisce il grafico e la combianazione di questi per creare qualsiasi tipo di grafico si voglia.  Vediamo un esempio. 

<!--
In order to unlock the full power of `ggplot2`, you need an overview of its undelying grammar. 
By understanding the grammar and how its components fit together, you can create a wider range of visualization, combine multiple source of data, and customize to your heart's content.
As we said, `ggplot2` is an R implementation of Leland Wilkinson's Grammar of Graphics, which is a formal and structured perspective on how to describe data graphics. `ggplot2` grammar is called layered as it is structured in building blocks. Its basic idea is to independently specify plot building blocks and combine them to create just about any kind of graphical display you want. 
Let us see an example.   
-->
Consideriamo il dataset `people` contenuto nel pacchetto `qdata`, che contiene informazioni personali di 300 persone italiane, quali il peso, l'altezza, il sesso e l'area geografica di appartenenza. 

<!--
Let us consider `people` dataset, included in `qdata` package. `people` dataset contains informations about weight, height, gender and geographical area of 300 italian people.  
-->

```{r load_qdata, message=FALSE}
require(qdata)
```

Supponiamo du
Suppose we want to visualize the relationship between weight and height of italian people according to the different geographical area, by using a **scatterplot**: 

```{r complete_plot, echo=FALSE,fig.width = 7}
# Load people dataset
data(people)

# Generate plot
ggplot(people, aes(x = Weight, y = Height, colour = Area)) +
  geom_point() +
  stat_smooth(method = "lm", se = F) +
  scale_colour_brewer(palette="Set1") +
  coord_equal() +
  facet_grid(. ~ Area) +
  ggtitle("Scatterplot of weight and height of \n italian people by geographical area") + 
    xlab("Weight (kg)") +
    ylab("Height (cm)") +
  theme(plot.background = element_blank(),
    axis.text = element_text(colour = "black"),
    axis.ticks = element_line(colour = "black"),
    axis.line.x = element_line(colour = "black"),
    axis.line.y = element_line(colour = "black"),
    axis.title = element_text(colour = "black", size = 14, face = "bold.italic"),
    strip.background = element_rect(colour = "black"),
    strip.text = element_text(colour = "black", face = "bold.italic", size = 12),
    plot.title = element_text(colour = "black", size = 20, face = "bold.italic", hjust = 0.5),
    panel.spacing = unit(1, "lines"),
    legend.position="none"
)
```

The previous plot is composed of building blocks that are added to the plot one after the other.   


The complete scheme of the most important building blocks of `ggplot2` grammar is displayed in the following figure:

```{r g1, echo=FALSE, purl=FALSE, fig.width = 4, fig.height = 3, eval=FALSE}
include_graphics("images/schema-layer-ggplot2-mod.png")
```


![](./images/schema-layer-ggplot2-mod.png)


The scheme must be read from bottom to top. Starting from bottom, the first three building blocks (<b> <span style="color:#FFBF00">Data</span> </b>, <b> <span style="color:#FF8000">Aestethic Mappings</span> </b> and <b> <span style="color:#FF0000">Layers</span> </b>) are fundamental to build a simple plot, indeed they are called 
__"key"__ building blocks. The remaining building blocks (<b> <span style="color:#9A2EFE">Scales</span> </b>, <b> <span style="color:#08298A">Coordinates</span> </b>, <b> <span style="color:#2E9AFE">Facets</span> </b> and <b> <span style="color:#01DF01">Themes</span> </b>) allow us to build a complex plot and to customize it; their use and order is not compulsory. 

Let us briefly describe the task of each element of the scheme and how it helps build the previous plot: 

1. <b> <span style="color:#FFBF00">Data</span> </b>: the dataset that we want to visualize

```{r g2, echo=FALSE, purl=FALSE, eval=FALSE}
include_graphics("images/schema-layer-ggplot2-data.png")
```


![](./images/schema-layer-ggplot2-data.png)


```{r data_1, eval=FALSE}
# iris dataset
data(people)
```

```{r data_2}
head(people)
```



2. <b> <span style="color:#FF8000">Aestethic Mappings</span> </b>: describes how variables in the data are mapped to aestethic attributes that you can perceive 

```{r g3, echo=FALSE, purl=FALSE}
include_graphics("images/schema-layer-ggplot2-aes.png", dpi=150)
```



| Gender | Area | Weight | Height | 
|--------|--------|:--------:|:--------:|
|  |  | x | y |


```{r aes}
ggplot(data = people, aes(x = Weight, y = Height))
```

3. <b> <span style="color:#FF0000">Layers</span> </b>: are made up by geometric elements and statistical transformations. In details, geometric objects (`geom`s) represent what we actually see on the plot: points, lines, polygons, etc. Statistical transformations (`stat`s) summarise data in many useful ways. For example, binning and counting observations to create an histogram, or summarising a 2d relationship with a linear model.       

```{r g4, echo=FALSE, purl=FALSE}
include_graphics("images/schema-layer-ggplot2-layer.png", dpi=150)
```


```{r layers}
# Scatterplot of the relationship between weight and height with regression line
ggplot(people, aes(x = Weight, y = Height)) +
  geom_point() + # layer 1 (draw points)
  stat_smooth(method = "lm", se = FALSE) # layer 2 (draw regression line) 
```


4. <b> <span style="color:#9A2EFE">Scales</span> </b>: map values in the data space to values in an aesthetic space, whether it be colour, or size or shape. Scales draw a legend on axes, which provide an inverse mapping to make it possible to read the original data values from the graph. Scales are closely related to aestethics mapped.

```{r g5, echo=FALSE, purl=FALSE}
include_graphics("images/schema-layer-ggplot2-scales.png", dpi=150)
```


```{r scales}
# map Area to colour in aes() and change the default colours of colour scale  
ggplot(people, aes(x = Weight, y = Height, colour = Area)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE) +
  scale_colour_brewer(palette="Set1")
```

5. <b> <span style="color:#08298A">Coordinates</span> </b> or coordinate system (`coord`) describe how data coordinates are mapped to the plane of the graphic. They also provides axes and gridlines to make it possible to read the graph. We normally use Cartesian coordinate system, but a number of others are available. 

```{r g6, echo=FALSE, purl=FALSE}
include_graphics("images/schema-layer-ggplot2-coord.png", dpi=150)
```


```{r coord}
# Change coordinate system 
ggplot(people, aes(x = Weight, y = Height, colour = Area)) +
  geom_point() +
  stat_smooth(method = "lm", se = FALSE) +
  scale_colour_brewer(palette="Set1") + 
  coord_equal() # change coord system (one unit on the x-axis is the same length as one unit on the y-axis)
```

6. <b> <span style="color:#2E9AFE">Facets</span> </b>: describes how to break up the data into subset and how to display those subsets as small multiples. 

```{r g7, echo=FALSE, purl=FALSE}
include_graphics("images/schema-layer-ggplot2-facet.png", dpi=150)
```


```{r facets, fig.width = 7}
# Generate a plot for each geographical area
ggplot(people, aes(x = Weight, y = Height, colour = Area)) +
  geom_point() +
  stat_smooth(method = "lm", se = FALSE) + 
  scale_colour_brewer(palette="Set1") +
  coord_equal() +
  facet_grid(. ~ Area)
```

7. <b> <span style="color:#01DF01">Themes</span> </b>: controls all non-data elements of the plot, like the font size, background colour, etc.

```{r g8, echo=FALSE, purl=FALSE}
include_graphics("images/schema-layer-ggplot2-mod.png", dpi=150)
```


```{r theme, fig.width = 8}
# Customize the appearance of the plot
ggplot(people, aes(x = Weight, y = Height, colour = Area)) +
  geom_point() +
  stat_smooth(method = "lm", se = FALSE) +
  scale_colour_brewer(palette="Set1") + 
  coord_equal() +
  facet_grid(. ~ Area) +
  ggtitle("Scatterplot of weight and height of \n italian people by geographical area") + # set title
    xlab("Weight (kg)") + # set x axis title
    ylab("Height (cm)") + # set y axis title
  theme(plot.background = element_blank(), # customize plot background
    axis.text = element_text(colour = "black"), # customize axes text
    axis.ticks = element_line(colour = "black"), # customize axes ticks
    axis.line.x = element_line(colour = "black"), # customize x axis line
    axis.line.y = element_line(colour = "black"), # customize y axis line
    axis.title = element_text(colour = "black", size = 14, face = "bold.italic"), # customize axes titles
    strip.background = element_rect(colour = "black"), # customize background of facet labels
    strip.text = element_text(colour = "black", face = "bold.italic", size = 12), # customize facet labels
    plot.title = element_text(colour = "black", size = 20, face = "bold.italic", hjust = 0.5), # customize plot title
    panel.spacing = unit(1, "lines"), # customize panels spacing
    legend.position = "none" # remove the legend
)
```



## Manual Contents

This manual is divided in three sections.  

The first section, _Base ggplot2_, explains how to build the most important kinds of plot. It deepens the use and the functionalities of the three key components of `ggplot2` grammar (data, aesthetic mapping and layers). It introduces also some basic concepts about the other components. 

The second section, _Advanced ggplot2_ explains how dealing with the most common questions about plot customization and deepens the remaining components of `ggplot2` grammar (scales, coordinates, facets and themes).  

The third section, _Other Topics_, talks about the `ggplot2` community and the packages built to support `ggplot2`. It shows also how to prepare plots for presentations, and how to save them to files.  


<!--

Each of the following chapters introduces a different plot with one or more related geometric object (`geom`). Moreover, each chapter introduces some basic concept about `ggplot2`, according to the following table.

| Plot          | Geoms | `ggplot2` key concepts introduced in the chapter                                                    |  
|---------------|-------|-----------------------------------------------------------------------------------------------------|
| Scatter plots | `geom_point` `geom_smooth`                         | aesthetics, _setting_ or _mapping_, geoms, assignment  |
| Line plots   | `geom_line` `geom_point` `geom_hline` `geom_vline` | `group` aesthetic, manual scales                       |
| Bar plots    | `geom_bar` `geom_text`                             | `stat`, hide legend, swapping axes                     |
| Histograms    | `geom_histogram` `geom_density`                    | faceting                                               |
| Box plots     | `geom_boxplot`                                     | titles and theme (plot title and axes ticks/titles)    |

The last chapter of the section shows how to prepare plots for presentations, and save them to files.
-->

## Datasets

This manual is full of examples, for which the following datasets have been used:

* `bands`: provides data about process delays known as cylinder banding in rotogravure printing
* `istat`: provides the measures of weight, height, gender and geographical area ("Nord", "Centro", "Sud" and "Isole") from 1806 Italian people
* `italy`: provides information about longitude, latitude and region of the most important italian cities
* `lung`: provides information about survival in patients with advanced lung cancer from the North Central Cancer Treatment Group
* `brainbod`: provides information about the weight of body and brain of different species of animals
* `bottlecap`: provides information about of the mean diameter of the caps produced by a forging machine
* `ChickWeight`: provides weight versus age of chicks on different diets
* `ToothGrowth`: provides the effect of Vitamin C on Tooth Growth in Guinea Pigs

`bands`, `istat`, `italy`, `lung` `brainbod` and `bottlecap` are included in `qdata` package, whereas `ChickWeight` and `ToothGrowth` are included in `datasets` package, that comes with base R.

For a complete description of data, refer to the help (`?<dataset name>`).


## Bibliography and References

To take a deeper look about `ggplot2` you can refer to:

 - [Chang W., _R Graphics Cookbook_, O'Reilly, 2012](http://www.cookbook-r.com/Graphs/) that provides a practical approach to `ggplot` and other R plots;
 - [Wickham H., _ggplot2: Elegant Graphics for Data Analysis_, Springer, 2009](http://ggplot2.org/book/) that provides technical details about Grammar of Graphics implemented in `ggplot2`.
 


