---
title: "Introduction to Standard R Graphics System"
output:
  html_document
---

```{r first, options, echo=FALSE, results='hide', message=FALSE, warning=FALSE, purl=FALSE}
require(knitr)
opts_chunk$set(fig.width=5.5, fig.height=4.5)
```



```{r require, message=FALSE}
require(qdata)
```


## The Graphic Environment

R comes with a wide variety of graphical functions. The R default `graphics` package provide standard R graphics. This chapter is about classical R graphics. 

The graphical functions in the base R system, can be divided into two groups:

 - **High level plot functions**. These functions produce "complete" graphics and will erase existing plots if not specified otherwise.
 - **Low level plot functions**. These functions are used to add graphical objects like lines, points and texts to existing plots.

Generally, high level graphic functions are named according to the corresponding graphics. Simple examples are: `barplot()`, `boxplot()`, `pie()`. A special case is the `plot()` function. This function is a generic function and perform differently according to its arguments or, more precisely, according to the class of the objects passed as arguments.

As a results:

```{r plot, fig.width=8, fig.height=8}
f <- factor(c("M", "M", "M", "M", "M", "F", "F","F"))
y <- rnorm(8)
x <- c(0, 2, 4, 8, 16, 32, 64, 128)
op <- par(mfrow = c(2, 2))
plot(y)
plot(f)
plot(x, y)
plot(f, x)
par(op)
```

_Note:_ Pay attention to `par()` function. It allows us to combine multiple plots into one overall graph, changing the default values of `mfrow` parameter. `mfrow` takes as input a vector of two elements, where the first specifies the number of rows and the second the number of columns of plots. As you can see from the example, `par(mfrow = c (4 ,2))` is assigned to `op` object. To restore the default values of `mfrow` parameter (which are `(1,1)`, i.e. only one plot in the overall graph), you just have to run `par(op)`.  

In the following two paragraphs we will see how we can build a **scatterplot** by using **High level plot functions** and **Low level plot functions**.

## High level plot functions

The scatterplot (or scattergraph) is the main tool for the study of bivariate numerical distributions. $(x_1, y_1), \dots, (x_n, y_n)$ indicate the sets of data obtained from the X, Y numeric variables. The scatterplot is a graph where the points $P_1 = (x_1, y_1), \dots, P_n = (x_n, y_n)$ are defined in a Cartesian coordinate system. The features of the point cloud, such as location, internal cohesion, direction, and presence of isolated points, enable the deduction of the distribution statistical characteristics (position, dispersion, correlation, anomalous data).

Generally, the `plot()` function is called to produce simple scatterplot.  
In the following examples, we will consider the `states` dataset included in `qdata` package. It contains  demographic, economic, geographical and social information about U.S States.

```{r scatterplot1}
data(states)
str(states)

plot(x = states$Illiteracy, y = states$Murder)
```

An alternative and more elegant way of calling the `plot()` function consist in specifying the `x` and `y` arguments by mean of a formula. Note that this method allows the data argument to be specified as an argument of the plot function.

```{r formula}
plot(Murder ~ Illiteracy, data = states)
```


### Type

When calling the `plot()` function, the argument type is set to its default: `type = "p"`. As a results graphics coordinates are represented by points (empty circles). Different graphical representations are given by: `"l"` for lines, `"o"` for overplotted points and lines, `"b"` for both points and lines, `"c"` for the lines parte alone of `"b"`, `"s"` and `"S"` for stair steps and `"h"` for histogram-like vertical lines. `type = "n"` is particularly important. In this case an empty plot with axes is created. The plot can be later customized in an extremely sophisticated way using more advanced graphic functions.

```{r type, fig.width=8, fig.height=9}
y <- c (1 , 2, 5 , 8, 9, 9, 7 , 5, 3, 1)
x <- 1:10

op <- par(mfrow = c (4 ,2))
plot(x, y, type = "p", xlab = "", ylab = "", main="type = p") # points (empty circles)
plot(x, y, type = "l", xlab = "", ylab = "", main="type = l") # lines
plot(x, y, type = "o", xlab = "", ylab = "", main="type = o") # overplotted points and lines
plot(x, y, type = "b", xlab = "", ylab = "", main="type = b") # both points and lines
plot(x, y, type = "c", xlab = "", ylab = "", main="type = c") # lines parte alone of "b"
plot(x, y, type = "s", xlab = "", ylab = "", main="type = s") # stair steps
plot(x, y, type = "h", xlab = "", ylab = "", main="type = h") # histogram-like vertical lines
plot(x, y, type = "n", xlab = "", ylab = "", main="type = n") # empty plot
par(op)
```


### Symbols

During the creation of the plot, the shape and the dimensions of the symbols can be customized with the `pch` and `cex` parameters respectively. 

```{r symbols}
plot(Murder ~ Illiteracy, data = states, pch = 16, cex = 2.5)
```

There are 25 symbols in R. Figure below shows these symbols and the reference values to be associated with the `pch` parameter.

```{r, echo = F, fig=T, purl=FALSE}
 # Make an empty chart
 plot(1, 1, xlim = c(1, 5.5), ylim=c(0.5, 5.5), type = "n", axes = FALSE, ann = FALSE, frame.plot = TRUE)
 # Plot symbols 0-4 with increasing size
 points(1:5, rep(5, 5), cex = 2, pch = 0:4)
 text((1:5) + 0.4, rep(5, 5), cex = 1, (0:4))
 # Plot symbols 5-9 with labels
 points(1:5, rep(4, 5), cex = 2, pch = (5:9))
 text((1:5) + 0.4, rep(4, 5), cex = 1, (5:9))
 # Plot symbols 10-14 with labels
 points(1:5, rep(3, 5), cex = 2, pch = (10:14))
 text((1:5) + 0.4, rep(3, 5), cex = 1, (10:14))
 # Plot symbols 15-19 with labels
 points(1:5, rep(2, 5), cex = 2, pch = (15:19))
 text((1:5) + 0.4, rep(2, 5), cex = 1, (15:19))
 # Plot symbols 20-25 with labels
 points((1:6) * 0.8 + 0.2, rep(1, 6), cex = 2, pch = (20:25))
 text((1:6) * 0.8 + 0.5, rep(1, 6), cex = 1, (20:25))
```

If you want to use a symbol which is not one of the standard 25, you can write it explicitly in the `pch` parameter. It needs to have only one character.

```{r custom}
plot(Murder ~ Illiteracy, data = states, pch = "R", cex = 2.5)
```

The `cex` parameter increases the dimension of the symbols as much as the parameter value. 

![](./images/graphics-A-cex.png)


### Colours

In R the `col` parameter manages the colours of the symbols inside the plots. `col` can be defined in different ways. Some of these methods are as follows:

 1. Specification of a number comprised between 1 and 8. In the graph above it is clear that these eight colours are repeated whenever there are multiples of eight. \newline
  ![](./images/graphics-A-col1.png)
 2. Specification of the name of the colour in English: "red", "blue", etc. There are 657 colours which can be defined in this way in R.  For a complete list of available colours digit the `colors()` function, without arguments.
 3. Use of the default colour sequence.  These sequences are available thanks to some functions in which the input parameter specifies the number of colours to be extracted from the colour space. The above-mentioned functions are `rainbow()`, `heat.colors()`, `terrain.colors()`, `topo.colors()` and `cm.colors()`. \newline
    ![](./images/graphics-A-col2.png)
 4. Specification of the colour in the hexadecimal format: "\#000000", "\#ffffff" ecc.

The following three lines of code produce the same result:

```{r colour_spec, eval=FALSE}
plot(Murder ~ Illiteracy, data = states, col = 2)
plot(Murder ~ Illiteracy, data = states, col = "red")
plot(Murder ~ Illiteracy, data = states, col = "#ff0000")
```

```{r colour, echo=FALSE}
plot(Murder ~ Illiteracy, data = states, col = "red")
```


### Titles

The `main` parameter of the `plot()` function enables the definition of the main title of the plot. This title will be displayed in the top centre of the plot. The `sub` parameter creates a subtitle which is displayed in the bottom centre of the plot. A title on two or more rows can be defined by inserting the special character "`\n`" in the title string.  Finally, the `xlab` and `ylab` parameters change the titles of the x and y axes respectively.

```{r titles}
plot(Murder ~ Illiteracy, data = states, 
     pch = 16, cex = 2.5, col = "blue",  
     main = "Murder vs Illiteracy", 
     sub="USA (1976)", 
     xlab = "Illiteracy rate",
     ylab = "Murder per 100,000 population")
```


### Axes

The `xlim` parameter sets a range for the x-axis. The `ylim` parameter sets a range for the y-axis. 
```{r axes}
plot(Murder ~ Illiteracy, data = states, 
     pch = 16, col = "blue", cex = 2.5, 
     main = "Murder vs Illiteracy", 
     sub="USA (1976)", 
     xlab = "Illiteracy rate", 
     ylab = "Murder per 100,000 population",
     xlim = c(0, 3), ylim = c(0, 18))
```



## Low level Functions

So far the main parameters of the `plot()` function have been dealt with. However, there are low-level functions which add information to top-level functions. Low-level functions only exist in association with a top-level function, which, in this case, is the `plot()` function. In the following paragraph it will be shown how some low-level functions can be used to improve the appearance of the graph and the information contained in the scatterplot.

### Points

The `points()` function enables a better control over the symbols used in the scatterplot. The scatterplot below can be created with the instructions of one of codes below.

```{r points0, eval=FALSE}
# High level plot function
plot(Murder ~ Illiteracy, data = states, pch = 16, cex = 2.5, col = "red")
```

```{r points}
plot(Murder ~ Illiteracy, data = states, type = "n")
# Low level plot function
points(Murder ~ Illiteracy, data = states, pch = 16, cex = 2.5, col = "red")
```

The difference between the methods lies in the points not being immediately created by the `plot()` function (`type = "n"` parameter creates an empty plot), but being added later thanks to the `points()` low-level function.

The `points()` function enables the management of the symbols in terms of a third variable. 

```{r threevariables}
# vector of colours to be used in the plot according to states.region.abb levels 
my_col <- as.character(factor(states$states.region.abb, labels = rainbow(4)))

plot(Murder ~ Illiteracy, data = states, type = "n")
points(Murder ~ Illiteracy, data = states, pch = 16, cex = 2.5, col = my_col)
```

The `my_col` variable is defined as a character vector with the same length as `states.region.abb`. The elements of `my_col` are the hexadecimal values of the four colours created by the `rainbow(4)` function.  In the `points()` function, the `my_col` vector is used to define the colour of each point in terms of the chosen variable.

<!--
### Text

A text can be inserted inside a scatterplot by specifying the coordinates. `text()` is a low-level function which introduces some text inside a graph. The input parameters of the `text()` function are:

 - a vector with x coordinates $(x_1, \dots ,x_n)$,
 - a vector with y coordinates $(y_1, \dots ,y_n)$,
 - a vector with the text to be inserted.

Clearly, the three above-mentioned vectors need to have the same length. Therefore, the text in the $i$-th position will be inserted in the Cartesian coordinate system in $(xi, yi)$. 

```{r text, purl=FALSE, eval=FALSE}
plot(Illiteracy ~ Murder, data = states, type = "n")
text(Illiteracy ~ Murder, data = states, labels = states$states.region.abb, col = "royalblue", cex = 0.8)
```

If the instructions in code above are analysed, it becomes clear that the `type = "n"` parameter creates an empty plot, but later on the `text()` function adds the text of the `states.region.abb` variable according to the coordinates provided by the `Murder` and `Illiteracy` variables. Some parameters of the `text()` function have been used to customise the output text. The `col` parameter defines the colour, whereas the `cex` parameter manages the size of the text.  
The `text()` function inserts generic text inside the plot. The coordinates defined in the `text()` function might have no links with those defined in the `plot()` function. An example is provided below.

```{r adj, purl=FALSE, eval=FALSE}
plot(Illiteracy ~ Murder, data = states, type = "n")
text(Illiteracy ~ Murder, data = states, labels = states$states.region.abb, col = "royalblue", cex = 0.8)
text(x = 2, y = 2.5, labels = "By Quantide", adj = c(0, 1), col = "darkgreen", cex = 2)
```

In the code below one of the arguments of the `text()` function is the `adj` parameter. The attribute of the `adj` parameter is a vector with two elements comprised between zero and one. These values indicate the horizontal and vertical alignment of the text (specified by `labels`) with its x and y coordinates.  Some examples of alignment are reported below:

 - `adj = c(0,0)` indicates an alignment on the bottom left. 
 - `adj = c(0.5,0.5)` indicates a central position compared with the x and y axes.
 - `adj = c(1,1)` indicates an alignment on the top right. 
-->

### Legend

When symbols with different colours, dimensions and shapes are used in a plot, a legend is needed. In R the `legend()` function inserts a legend which can be highly customized. 

```{r legend}
# vector of colours to be used in the plot according to states.region.abb levels 
my_col <- as.character(factor(states$states.region.abb, labels = rainbow(4)))

plot(Murder ~ Illiteracy, data = states, type = "n")
points(Murder ~ Illiteracy, data = states, pch = 16, cex = 2.5, col = my_col)
legend(x = "bottomright", legend = levels(states$states.region.abb),
  col = rainbow(4, start = 0.3, end = 0.8), pch = 16, ncol = 4,
  title = "State Region")
```

The input parameters of the `legend()` function are `x` and `y`. They determine the coordinates where the box with the legend will be inserted. More specifically, the coordinates define the position of the top-left corner of the box. The location of the legend is usually specified by the `x` parameter only, using the following values:

 | |
----------- | ----------- | -----------
`"topleft"` | `"top"` | `"topright"` 
`"left"` | `"center"` | `"right"`
`"bottomleft"`| `"bottom"` | `"bottomright"`  

The `legend` parameter defines the legend text. The `ncol` parameter sets the number of columns of the legend; if it is not specified the legend will have only one column. The `title` parameter inserts a title for the legend.  
In this case, one legend has been inserted in the plot but there are no limits as to how many legends can be inserted in a plot. 

### Lines

In a generic plot, lines can be added with the `abline()` function. With sufficient parameters the `abline()` function draws a straight line in the graph. Horizontal and vertical straight lines are drawn with the `abline()` function by specifying the `h` and `v` parameters respectively. For example, `h = 4` draws on the Cartesian coordinate system a straight horizontal line with the equation $y = 4$. On the other hand, `v = 7` draws on the Cartesian coordinate system a straight vertical line with the equation $x = 7$. Oblique lines are created by the `abline()` function with the `a` and `b` parameters which respectively indicate the slope and the intercept of the desired line. For example, if `a = 2` and `b = 5` the straight line on the Cartesian coordinate system will have the equation $y = 2x + 5$. The `reg` parameter of the `abline()` function accepts any regression object with a `coefficients` method and uses the coefficients to draw the line.

`lty`, `lwd` and `col` parameters determine the line type, width and colour in the `abline()` function. Figure below shows six types of lines created by the `lty` parameter.

![](./images/graphics-A-lines.png)

The following code contains an example of the use of `ablines()` function.

```{r lines}
plot(Murder ~ Illiteracy, data = states, type = "n")
abline(h = mean(states$Murder), v = mean(states$Illiteracy), col = "gray80", lwd = 2)
abline(reg = lm(states$Murder~states$Illiteracy), col = "red", lwd = 2)
points(Murder ~ Illiteracy, data = states, pch = 16, col = "darkblue")
grid()
```

`abline()` function is used two times. Once the `h` and `v` parameters are set to draw lines in correspondance to the mean value of `Murder` and `Illiteracy` respectively. In the second use, `abline()` draws the regression line between `Murder` and `Illiteracy`. In this case, `lm()` function is used to determine the intercept and the slope of the regression line.    
The `points()` function has been used after `abline()` to prevent points from being hidden by the line drawn in the plot.    
Finally, `grid()` function draws a grid which aligns with the tick marks on the axes. 


### Titles

`title()` is a low-level function which inserts the title in a plot. There are four different positions for a title in a graph:  

 1. top-centre
 2. bottom-centre
 3. as label for the x-axis
 4. as label for the y-axis

If the `outer` parameter is set on `TRUE`, the title will be placed in the outer margin of the plot. The `cex` parameter controls the size of the title. The function is usually used to define main titles, whereas axes labels are managed with the `xlab` and `ylab` parameters of the `plot()` function or the `label` parameter of the `axis()` function. The "`\n`" symbol inside the string of the main title splits the title over two lines.

```{r title}
plot(Murder ~ Illiteracy, data = states, type = "n")
abline(h = mean(states$Murder), v = mean(states$Illiteracy), col = "gray80", lwd = 2)
abline(reg = lm(states$Murder~states$Illiteracy), col = "red", lwd = 2)
points(Murder ~ Illiteracy, data = states, pch = 16, col = "darkblue")
grid()
title(main = "Murder vs Illiteracy \n Usa (1974)", cex = 1.2)
title(sub = "Plot with Regression Line", cex = 1)
```



## Other Plot Types

### Histograms
A histogram is a representation of a frequency distribution by means of rectangles whose widths represent class intervals and whose areas are proportional to the corresponding frequencies. 

When the `freq` argument of `hist()` is set to `FALSE` probability densities are plotted so that the histogram has a total area of one. 

In the following two example we will refer to `cars` data included in `datasets` package. `cars` includes information about speed and stopping distances of dars.

```{r cars, message=FALSE}
data(cars)
str(cars)
```

```{r hist}
op <- par(mfrow = c(1, 2))
  hist(cars$speed, main = "Frequency Histogram")
  hist(cars$speed, freq = F, main = "Density Histogram")
par(op)
```

The number of breaks/classes is automatically determined but can be defined if required by specifying either the numbers of classes or the break points: 

```{r nclass, fig.width=8}
op <- par(mfrow = c(1, 2))
  hist(cars$dist, nclass = 12, main = "Specifying Number of Classes", col = "gray")
  hist(cars$dist, nclass = seq(0, 120, by = 20), freq = F, main = "Specifying Break Points", col = "lightgray")
par(op)
```


### Barplot

A bar plot displays the frequencies (or relative frequencies) for categorical variables. Generally, a grouping function such as `table()` is applied to data prior to draw barplots.

This example refers to `bwt` data of `qdata` package, which is about low birth weight in infants born at a US hospital.

```{r bwt, message=FALSE}
data(bwt)
str(bwt)
```

```{r barplot}
tb <- table(bwt$smoke)
barplot(tb, col = c("orange", "darkgreen"))
```

When introducing two or more variables, barplots can be constructed in stacked or beside mode. A simple legend may added to the plot by setting to `TRUE` the `legend` argument.

```{r barplotlegend, fig.width=8}
tb2 <- table (bwt$smoke, bwt$low)
op <-  par(mfrow = c(1,2))
barplot(tb2, col = c("pink", "gray"), main = "Stacked bars", legend = T)
barplot(tb2, col = c("darkgreen", "brown"), main = "Beside bars", beside = T, legend = T)
par(op)
```


### Boxplot

"Box and whiskers" plots, often called boxplots, are a way of summarizing and comparing data distributions.

The "box" in a boxplot shows the median as a line and the first (25th percentile) and third quartile (75th percentile) of the distribution as the lower and upper parts of the box.

The "whiskers" shown above and below the boxes technically represent the largest and smallest observed data that are less than 1.5 box lengths from the end of the box. In practice, these data are about the lowest and highest values one is likely to observe. Data above or below whiskers are shown as open circles "o" or stars. 

In comparing the boxplots across groups, a simple summary is to say that the "box" area for one group is higher or lower than that for another group. 

This example refers to `carseat` data of `qdata` package. `carseat` contains data of an experiment about the reproducibility of a measurement method aiming to test resistance of a specific material used to cover car seats. As a result, an experiments involving 75 samples of material from the same batch is set up. Three operators: Kevin, Michelle and Rob are assigned to test 25 samples each.

```{r boxplot}
data(carseat)
boxplot(Strength ~ Operator, data = carseat)
```

Formula method seems to be the only alternative unless reshaping data in wide format before drawing the boxplot.

