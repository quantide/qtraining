---
title: "How making a surface plot"
author: "Veronica"
date: "October 20, 2016"
output: html_document
---

## Surface Plots

`ggplot2` does not support true 3d surfaces. However it does support many common tools for representing 3d surfaces in 2d: contours, coloured tiles and bubble plots. These all works similarly, differing only in the aesthetic used for the third dimension  

```{r}
ggplot(data=bands, mapping=aes(x = humidity, y=viscosity)) + 
  geom_contour(aes(z = density.., colour = ..level..))
```






Density plots can be realized also for two-dimensional (2D) data, making a 2D kernel density estimate. 
A two-dimensional kernel density estimate is generated by `geom_density2d()`, which is analogous to the one-dimensional density estimate generated by `geom_density()`, but of course, it needs to be viewed in a different way. 
The default is to use contour lines. Contour lines are a tool for representing 3d surfaces in 2d, as `ggplot2` does not support true 3d surfaces. 

Suppose we are interested in the relationship between `humidity` and `viscosity` in bands dataset:

```{r}
ggplot(data=bands, mapping=aes(x = humidity, y=viscosity)) + 
  geom_density2d()
```

The density contour can be plotted also along with the data points:

```{r}
ggplot(data=bands, mapping=aes(x = humidity, y=viscosity)) + 
  geom_point() +
  geom_density2d()
```

It’s also possible to map the height of the density curve to the color of the contour lines, by mapping `..level..` to `colour` scale:

```{r}
ggplot(data=bands, mapping=aes(x = humidity, y=viscosity)) + 
  stat_density2d(aes(colour=..level..))
```

Besides contour lines it is also possible to use tiles and map the density estimate to the fill color, or to the transparency of the tiles.

Let us see two examples, in which we use `stat_density2d()` which is the analogous of `geom_density2d()`:

<!--
modificare la frase sopra
-->

```{r}
ggplot(data=bands, mapping=aes(x = humidity, y=viscosity)) + 
  stat_density2d(aes(fill=..density..), geom="raster", contour=FALSE)
```


```{r}
ggplot(data=bands, mapping=aes(x = humidity, y=viscosity)) + 
  geom_point() +
  stat_density2d(aes(alpha=..density..), geom="tile", contour=FALSE)
```


We used `geom="raster"` in the first of the preceding examples and `geom="tile"` in the second. The main difference is that the `"raster"` geom renders more efficiently than the `"tile"` geom. In theory they should appear the same, but in practice they often do not. If you are writing to a PDF file, the appearance depends on the PDF viewer. On some viewers, 
when tile is used there may be faint lines between the tiles, and when raster is used the edges of the tiles 
may appear blurry (although it doesn’t matter in this particular case).

As with the one-dimensional density estimate, you can control the bandwidth of the estimate. 
To do this, pass a vector for the x and y bandwidths to `h` argument. This argument gets passed on to the function that actually generates the density estimate, `kde2d()`. In the following example, we use a smaller bandwidth in the x and y directions, so that the density estimate is more closely fitted (perhaps overfitted) to the data:

```{r}
ggplot(data=bands, mapping=aes(x = humidity, y=viscosity)) + 
  stat_density2d(aes(fill=..density..), geom="raster", contour=FALSE, h=c(.5,5))
```
