---
title: "More on the overall appearance of plot"
output: html_document
---

```{r, message=FALSE}
require(ggplot2)
require(xtable)
require(qdata)
data(bands)
```

## Intro struttura themes

The overall appearance of plots is controlled by the theming system. We learned about the theming system in the previous chapters, in particular in "More on legends", "More on axes" and "More on facets", where we saw how themes give us the control of non-data elements of the plot like fonts, ticks, panel strip, legend keys, ..

Let us schematize the theming system structure.

`ggplot2` has a default theme, called `theme_grey()`, with a light grey background and white gridlines. Its is composed of:

* __theme elements__, which refer to individual attributes of a graphic that are independent of the data and that you can control, such as font size, axis ticks, appearance of grid lines or background color of a legend;

* __theme element functions__, which enables you to modify the settings of certain theme elements. In particular, each theme element is associated with an element function, which describes the visual properties of that element.

Each theme element has a default value that can be locally modified in a specific ggplot object by using __`theme()` function__.

Moreover, `theme_grey()` theme elements can be totally replaced by __theme functions__ (complete themes), which define the settings of a collection of theme elements for the purpose of creating a specific style of graphics production. 

<!--
The theming system is composed of four main components:

* __theme elements__, which refer to individual attributes of a graphic that are independent of the data and that you can control, such as font size, axis ticks, appearance of grid lines or background color of a legend;

* __theme element functions__, which enables you to modify the settings of certain theme elements. In particular, each theme element is associated with an element function, which describes the visual properties of that element 

* the __`theme()` function__, used to locally modify one or more theme elements in a specific ggplot object;

* __theme functions__ (complete themes), which define the settings of a collection of theme elements for the purpose of creating a specific style of graphics production.
-->

Let us describe in depth __theme element functions__ and __theme elements__.  

__Theme element functions__ are four:

* `element_text()`: controls the drawing of labels and headings. The table below lists its arguments and their corresponding default values:

```{r, echo=FALSE, results='asis'}
dt_format_table <- data.frame(Argument = c("family", "face", "colour", "size", "hjust", "vjust", "angle", "lineheight"),
                              Description = c("font family", "font face", "font color", "font size (pts)", "horizontal justification", "vertical justification", "text angle", "line height"),
                              Value = c("''", "'plain'", "'black'", "10", "0.5", "0.5", "0", "	1.1"),
                              stringsAsFactors = FALSE)
names(dt_format_table) <- c("Argument", "Description", "Default Value")
dt_format_table <- xtable(dt_format_table, align = c("c", "c", "c", "c"))
tab.attributes <- 'border="0" align="left" rules="all" style=" border-collapse: collapse;  font-size: 12pt; padding: 50px; width: 70%;"'
print(dt_format_table, include.rownames=FALSE, type='html', NA.string=NA, html.table.attributes=tab.attributes)
```

* `element_line()`: draws lines and segments such as graphics region boundaries, axis tick marks and grid lines. The table below lists its arguments and their corresponding default values:

```{r, echo=FALSE, results='asis'}
dt_format_table <- data.frame(Argument = c("colour", "size", "linetype"),
                              Description = c("line color", "line thickness", "type of line"),
                              Value = c("'black'", "0.5", "1"),
                              stringsAsFactors = FALSE)
names(dt_format_table) <- c("Argument", "Description", "Default Value")
dt_format_table <- xtable(dt_format_table, align = c("c", "c", "c", "c"))
tab.attributes <- 'border="0" align="left" rules="all" style=" border-collapse: collapse;  font-size: 12pt; padding: 50px; width: 70%;"'
print(dt_format_table, include.rownames=FALSE, type='html', NA.string=NA, html.table.attributes=tab.attributes)
```

* `element_rect()`: draws rectangles. It is mostly used for background elements and legend keys. The table below lists its arguments and their corresponding default values:

```{r, echo=FALSE, results='asis'}
dt_format_table <- data.frame(Argument = c("fill", "colour", "size", "linetype"),
                              Description = c("fill color", "border color", "	thickness of border line", "type of border line"),
                              Value = c("NA (none)", "'black'", "0.5", "1 (solid)"),
                              stringsAsFactors = FALSE)
names(dt_format_table) <- c("Argument", "Description", "Default Value")
dt_format_table <- xtable(dt_format_table, align = c("c", "c", "c", "c"))
tab.attributes <- 'border="0" align="left" rules="all" style=" border-collapse: collapse;  font-size: 12pt; padding: 50px; width: 70%;"'
print(dt_format_table, include.rownames=FALSE, type='html', NA.string=NA, html.table.attributes=tab.attributes)
```


* `element_blank()`: draws nothing. This function has no arguments.


__theme elements__

There are around 40 unique elements that controls the appearance of the plots. They can be roughly grouped into five categories:

* plot

```{r, echo=FALSE, results='asis'}
dt_format_table <- data.frame(Element = c("plot.background", "plot.title", "plot.margin"),
                              Setter = c("element_rect()", "element_text()", "margin()"),
                              Description = c("plot background", "plot title", "margins around plot"),
                              stringsAsFactors = FALSE)

dt_format_table <- xtable(dt_format_table, align = c("c", "c", "c", "c"))
tab.attributes <- 'border="0" align="left" rules="all" style=" border-collapse: collapse;  font-size: 12pt; padding: 50px; width: 70%;"'
print(dt_format_table, include.rownames=FALSE, type='html', NA.string=NA, html.table.attributes=tab.attributes)
```
    Let us see an example considering the realtionship between humidity and viscosity by pressure type in `bands` dataset:
    
```{r}
pl <- ggplot(data = bands, mapping = aes(x= humidity, y = viscosity, colour =press_type)) +
  geom_point()

pl + labs(title = "Plot title") +
  theme(plot.title = element_text(size = 20, vjust = 2),
        plot.background = element_rect(
          fill = "lightblue",
          colour = "black",
          size = 2,
          linetype = "longdash"),
        plot.margin = unit(c(1, 1, 1, 1), "in"))
```

* axis

```{r, echo=FALSE, results='asis'}
dt_format_table <- data.frame(Element = c("axis.line", "axis.text", "axis.text.x", "axis.text.y", "axis.title", "axis.title.x", 
                                          "axis.title.y", "axis.ticks", "axis.ticks.length", "axis.ticks.margin"),
                              Setter = c("element_line()", "element_text()", "element_text()", "element_text()", "element_text()", "element_text()", "element_text()", "element_line()", "unit()", "unit()"),
                              Description = c("line parallel to axis (hidden in default theme)", "tick labels", "x-axis tick labels", 
                                              "y-axis tick labels", "axis titles", "x-axis title", "y-axis title", "axis tick marks", 
                                              "length of tick marks", "width of axis tick margin"),
                              stringsAsFactors = FALSE)

dt_format_table <- xtable(dt_format_table, align = c("c", "c", "c", "c"))
tab.attributes <- 'border="0" align="left" rules="all" style=" border-collapse: collapse;  font-size: 12pt; padding: 50px; width: 70%;"'
print(dt_format_table, include.rownames=FALSE, type='html', NA.string=NA, html.table.attributes=tab.attributes)
```
  Let us see an example:
  
```{r}
pl + theme(
  axis.line.x = element_line(colour = "red", size = 2),
  axis.line.y = element_line(colour = "orange", linetype = "dashed"),
  axis.text = element_text(color = "blue", size = 15, face = "italic"),
  axis.text.y = element_text(angle = 90, size = rel(0.7), hjust = 0),
  axis.ticks = element_line(colour = "violet"),
  axis.ticks.x = element_line(size = rel(2)),
  axis.title = element_text(size = 20, color = "maroon")
)
```

* legend

```{r, echo=FALSE, results='asis'}
dt_format_table <- data.frame(Element = c("legend.background", "legend.key", "legend.key.size", "legend.key.height", "legend.key.width", 
                                          "legend.margin", "legend.text", "legend.text.align", "legend.title", "legend.title.align",
                                          "legend.position", "legend.direction", "legend.justification", "legend.box"),
                              Setter = c("element_rect()", "element_rect()", "unit()", "unit()", "unit()", "unit()", "element_text()",
                                         "numeric", "element_text()", "numeric", "'left', 'right', 'bottom' ', 'top'", "numeric", 
                                         "numeric", "numeric"),
                              Description = c("legend background", "background of legend keys", "", "legend key height", 
                                              "legend key width", "legend margin", "legend labels", "legend label alignment",
                                              "legend name", "legend name alignment", "position of legend", "direction of legend keys", 
                                              "justification of legend", "position of multiple legend boxes"),
                              stringsAsFactors = FALSE)

dt_format_table <- xtable(dt_format_table, align = c("c", "c", "c", "c"))
tab.attributes <- 'border="0" align="left" rules="all" style=" border-collapse: collapse;  font-size: 12pt; padding: 50px; width: 70%;"'
print(dt_format_table, include.rownames=FALSE, type='html', NA.string=NA, html.table.attributes=tab.attributes)
```

```{r}
pl + theme(
  legend.position = "top",
  legend.box = "horizontal",
  legend.background = element_rect(
      fill = "lemonchiffon",
      color = "black",
      size = 2,
      linetype = "longdash"
    ),
  legend.key = element_rect(fill = "pink", color = "magenta"),
  legend.key.width = unit(0.5, "in"),
  legend.key.height = unit(0.2, "in"),
  legend.text = element_text(
  face = "bold", size = 12, angle = 0, colour = "magenta"
))
```

* panel

```{r, echo=FALSE, results='asis'}
dt_format_table <- data.frame(Element = c("panel.background", "panel.border", "panel.grid.major", "panel.grid.major.x", "panel.grid.major.y", 
                                          "panel.grid.minor", "panel.grid.minor.x", "panel.grid.minor.y", "panel.margin", "aspect.ratio"),
                              Setter = c("element_rect()", "element_rect()", "element_line()", "element_line()", "element_line()",
                                         "element_line()", "element_text()", "element_line", "numeric", "numeric"),
                              Description = c("background of graphics region", "border of graphics region", "major grid lines", 
                                              "vertical major grid lines height", "horizontal major grid lines", "minor grid lines", 
                                              "vertical minor grid lines", "horizontal minor grid lines",
                                              "margin between facets", "plot aspect ratio"),
                              stringsAsFactors = FALSE)

dt_format_table <- xtable(dt_format_table, align = c("c", "c", "c", "c"))
tab.attributes <- 'border="0" align="left" rules="all" style=" border-collapse: collapse;  font-size: 12pt; padding: 50px; width: 70%;"'
print(dt_format_table, include.rownames=FALSE, type='html', NA.string=NA, html.table.attributes=tab.attributes)
```

```{r}
pl + theme(
  panel.background = element_rect(fill = "navy", color = "orange", size = 2),
  panel.border = element_rect(fill = NA, colour = "orange", size = 2),
  panel.grid.major = element_line(color = "gray60", size = 0.8),
  panel.grid.major.x = element_blank(),
  legend.position = "none")

ggplot(data = bands, mapping = aes(x= humidity, y = viscosity)) +
  geom_point() + facet_wrap(~ press_type) +
  theme(
    panel.margin = unit(0.5, "in")
  )

```

* facet

```{r, echo=FALSE, results='asis'}
dt_format_table <- data.frame(Element = c("strip.background", "strip.text", "strip.text.x", "strip.text.y"),
                              Setter = c("element_rect()", "element_text()", "element_text()", "element_text()"),
                              Description = c("background of panel strips", "strip text", "horizontal strip text", 
                                              "vertical strip text"),
                              stringsAsFactors = FALSE)

dt_format_table <- xtable(dt_format_table, align = c("c", "c", "c", "c"))
tab.attributes <- 'border="0" align="left" rules="all" style=" border-collapse: collapse;  font-size: 12pt; padding: 50px; width: 70%;"'
print(dt_format_table, include.rownames=FALSE, type='html', NA.string=NA, html.table.attributes=tab.attributes)
```

```{r}
ggplot(data = bands, mapping = aes(x= humidity, y = viscosity)) +
  geom_point() + facet_grid(band_type ~ press_type) +
  theme(
    strip.background = element_rect(fill = "cornsilk", color = "maroon", size = 2),
    strip.text = element_text(face = "italic", size = 15, colour = "red"),
  strip.text.y = element_text(face = "bold")
  )
```

We have already learn about most of these ggplot2 functionalities in the previous chapters, in particular: axis, legend and facet. But what's about plot and panels? 

In the following paragraphs we will see how to handle with the most common questions on plot, panels and theme customization.

## 



## hiding grid lines


## premade themes + ggthemes

## creating your own theme