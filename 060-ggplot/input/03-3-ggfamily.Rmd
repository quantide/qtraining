---
title: "ggfamily"
output: html_document
---

```{r setup, include=FALSE, warning=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

There are lots of packages which are `ggplot2` extensions.  
In this chapter we will anlyze the most important:

* `GGally`
* `ggmap`


## GGally

`GGally` is a convenient package built upon `ggplot2` for correlation matrix and survival plots written and mantained by Barret Schloerke. It reduces the complexity of combining geometric objects with transformed data.

`GGally` extends `ggplot2` by providing several functions including:

`ggcor()`: for pairwise correlation matrix plot
`ggpairs()`: for scatterplot plot matrix
`ggsurv()`: for survival plot

Supposing you have already installed it, you have to load it:

```{r}
require(GGally)
```

### ggcorr(): Plot a correlation matrix

The function `ggcorr()` draws a correlation matrix plot using `ggplot2`.

The simplified format is:

```{r}
ggcorr(mtcars, palette = "RdBu", label = TRUE)
```

<!--
cambiare i dati?
-->

## `ggpairs()`: for scatterplot plot matrix

`ggpairs()` function contains templates for different plots to be combined into a plot matrix. It is a nice alternative to the more limited `pairs` function of `graphics` package.

```{r}
ggpairs(data=istat, # dataframe with variables
        columns = 2:4, # columns to be used to make plots
        title="Matrix Plot of istat data") # title of the plot
```

Plots like the one above are very helpful, among others things, in the pre-processing stage of a classification problem, where you want to analyze your predictors given the class labels. It is particularly amazing that we can now use the arguments `colour`, `shape`, `size` and `alpha` provided by `ggplot2`:

```{r}
ggpairs(data=istat, # data.frame with variables
        mapping = aes(colour=Area), # esthetic mapping (besides x and y)
        columns = 2:4, # columns to be used to make plots
        title="Matrix Plot of istat data") # title of the plot
```

We have some control over which type of plots to use. We can choose which type of graph will be used for continuous vs. continuous (`continuous`) and discrete vs. discrete (`discrete`) and continuous vs. discrete (`combo`). We can also have different plots for the upper diagonal (`upper`), for the diagonal (`diagonal`) and for the lower diagonal (`lower`).

```{r}
ggpairs(data=istat,
        mapping = aes(colour=Area), # esthetic mapping (besides x and y)
        columns=2:4, 
        upper=list(continuous = 'cor', discrete = 'facetbar', combo ='facethist'),
        lower=list(continuous = 'smooth', discrete = 'facetbar', combo ='dot'),
        diag=list(continuous = 'barDiag', discrete = 'barDiag'),
        title="Matrix Plot of istat data")
```

For example, the code above, set to use in the upper diagonal: correlations for continuous vs. continuous variables, faceted bar plot for discrete vs. discrete variables and faceted histograms for continuous vs. discrete variables.

## `ggsurv()`: for survival plot

`ggsurv()` produces Kaplan-Meier plots using `ggplot2`.

Let us see an example, considering `lung` data from package `survival`:

```{r}
require(survival)
data(lung, package = "survival")
```

`lung` data is about survival in patients with advanced lung cancer. 

```{r, eval=FALSE}
lung <- lung[, c(2,3,5)]
```

<!--
salvare lung in qdata (solo le tre colonne di interesse)
-->

We consider only the following variables:  

* `time`: Survival time in days
* `status`: censoring status 1 = censored, 2 = dead
* `sex`: Male = 1; Female = 2

As a first argument `ggsurv()` needs a survfit object, created by the `survival` package:

```{r}
# Fit survival functions
surv <- survfit(Surv(time, status) ~ sex, data = lung)
# Plot survival curves
ggsurv(surv) + 
  guides(linetype = FALSE) +
  scale_colour_discrete(name   = 'Sex', breaks = c(1,2), 
                      labels = c('Male', 'Female'))
```

