### LIST OF SOURCE FILES (without extension: it will be used for .rmd, .html and .R)
LIST = \
  M0_introduction \
	M1_linearModels_man \
	M2_generalizedLinearModels_man \
	M2a_generalizedLinearModels_Multinomial-NegBin_man \
	M4_appendices_man \


### LIST OF MD FILES TO BUILD PDF
MD = $(addsuffix .md,$(LIST))


### PARAMETERS
# FTP PARAMETERS
FTP_URL = ftp://ftp.quantide.com/public/www/web-books/raccoon
FTP_URL_HTML = $(FTP_URL)/html/
FTP_URL_SCRIPTS = $(FTP_URL)/R/
FTP_USER = quantidephpftp
FTP_PWD = nel2014vadoalmaremapreferiscolamontagna

# PANDOC PATH (RSTUDIO VERSION)
PANDOC_PATH = /usr/lib/rstudio/bin/pandoc/pandoc

# PDF PARAMETERS
PDF_OUT = Raccoon.pdf

# PANDOC PDF OPTIONS
PANDOC_PDF_OPTIONS = \
  --latex-engine xelatex \
  --data-dir='./' --template='manual.tex' \
	--variable=geometry:a4paper \
	--variable=links-as-notes \
  --chapters \
  --number-sections \
	--toc


### COMPILE
# all: by default perform all actions
all: knitr purl html pdf

# build md files from rmd
%.md: %.Rmd
	Rscript -e "require(knitr); knit('$<', quiet=FALSE)"

# build html files from md and upload
%.html: %.md
	Rscript -e "require(rmarkdown); render('$<', html_document())" 
	sed -i -e '1,/<body>/d' -e '/^<\/body>/,$$d' $*.html
#	curl -T $*.html $(FTP_URL_HTML) --user $(FTP_USER):$(FTP_PWD)

# build R files from rmd and upload
%.R: %.Rmd
	Rscript -e "require(knitr); purl('$<')"
#	curl -T $*.R $(FTP_URL_SCRIPTS) --user $(FTP_USER):$(FTP_PWD)

# build pdf file from md
$(PDF_OUT): $(MD)
	$(PANDOC_PATH) $(PANDOC_PDF_OPTIONS) $(MD) --output $(PDF_OUT)

# single actions
knitr: $(MD)
html: $(addsuffix .html,$(LIST))
purl: $(addsuffix .R,$(LIST))
pdf: $(PDF_OUT)
